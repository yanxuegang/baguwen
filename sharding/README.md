# 概述
分析：分库分表的面试题还是属于比较复杂的。这种复杂体现在两方面，一方面是分库分表从理论上来说就很复杂；另外一方面这种复杂度也体现在实践上。

从理论上来说，则是要掌握分库分表中间件的设计原理：
- [改写 SQ](./rewrite_sql.md)L：给出一个逻辑 SQL 和相应的分库分表规则，你应该能够说清楚它的目标库和目标表
- 执行 SQL：重点要考虑
  - 目标 SQL 能不能并发执行
  - 修改数据类的查询，例如说 INSERT、UPDATE、DELETE 之类的语句，如果目标 SQL 有多个，那么如果出现部分失败的问题该怎么解决
  - 事务怎么处理
- 处理结果集：这个过程和前面改写 SQL 是很密切相关的，要考虑
  - 排序和分页
  - 聚合函数

从实践中来说，则要掌握：
- 为什么要分库分表：这个问题要结合读写分离、分区表来综合回答；更进一步则要说清在具体的业务场景下，应该分库还是分表，还是说都要；高端点则要将分库分表和其它中间件进行一个横向比较，站在一个集群模式的角度去讨论这个问题
- 实际中如何分库分表：
  - 怎么挑选分库分表的键
  - 主键怎么生成：不同策略的优缺点和潜在问题
  - 从单裤单表开始分库分表，要怎么做
  - 怎么计算分库分表应该要分多少库、多少表
  - 如果中途发现分库分表需要扩容，怎么扩容：
    - 怎么做数据迁移
    - 怎么做数据校验
    - 怎么切换流量
    - 怎么做好回滚：即万一中间任何一个步骤出问题，能不能回滚，怎么回滚
- 分库分表的性能问题
  - 排序查询性能问题以及优化方案
  - 分页查询性能问题以及优化方案
- 非典型查询，是指不符合分库分表初衷的查询。例如在订单表中，典型的分库分表方案是使用买家 ID，那么如果卖家要查询自己卖了多少单，就很难查询

你们在背八股文的时候记得按照顺序看下去，因为有些内容是存在先后依赖关系的，比如说你先看改写 SQL 的内容，你就很难理解后面执行 SQL 和合并结果集的内容。

如果你们有兴趣，可以考虑报名我在极客时间开设的实战训练营，在里面的直播主题课分库分表里面，我比较详细讨论了分库分表中间件设计的弯弯绕绕。

在面试的时候，如果你不是真的面试中间件研发岗位，那么面试重点会侧重在实践中。但是如果你想面试万无一失，那么你应该同时掌握理论，并且能够自己设计并且实现一个简单的分库分表中间件。

