# Go 语言

## 面试题

### Go 语言时间精度问题

在 Go 语言里面，和时间相关的中间件或者框架都需要注意时间精度的问题。

我们用阻塞超时的例子来给大家描述时间精度可能源自哪些方面。例如说，我们在使用并发等待队列的时候，入队的超时时间设置了一秒，那么你究竟什么时候会收到超时错误，是不确定。这是因为：
- 时钟精度。时钟并不能在恰好一秒的时候就发出时钟中断；
- 阻塞：如果 goroutine 本身已经被阻塞了，那么从收到时钟中断，到唤醒 goroutine，到返回超时错误，需要一段时间。在 Go 里面还多了一个开销，就是返回超时错误意味着 goroutine 需要被调度到 P 上面执行。但是如果这个时候 P 忙着处理其它 goroutine，那么这个 goroutine 还需要等待 P 的调度（虽然 goroutine 本身是处于一种可以被调度的状态）。而造成阻塞的原因有很多：
  - 和 channel 交互，例如发数据到满了的 channel，或者从一个空的 channel 里面接受数据
  - 竞争锁，别的 goroutine 持有锁一直没有释放，那么 goroutine 就会一直被阻塞

